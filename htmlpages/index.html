<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Clone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="module" src="{{ url_for('static', path='/firebase-login.js') }}"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'instagram-blue': '#0095f6',
                        'instagram-red': '#ed4956',
                        'instagram-border': '#dbdbdb',
                        'instagram-light': '#fafafa',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        .story-ring {
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
        }

        .instagram-logo {
            font-family: 'Billabong', cursive;
        }

        @font-face {
            font-family: 'Billabong';
            src: url('https://fonts.cdnfonts.com/css/billabong') format('woff2');
        }
    </style>

    <style>
        .modal-backdrop {
            backdrop-filter: blur(5px);
            background-color: rgba(0, 0, 0, 0.5);
        }

        .hidden {
            display: none;
        }

        .image-preview {
            max-height: 500px;
            object-fit: contain;
        }

        .modal-content {
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .insta-search-results {
            max-height: 400px;
            overflow-y: auto;
        }

        .insta-search-results::-webkit-scrollbar {
            width: 6px;
        }

        .insta-search-results::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .insta-search-results::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }

        .insta-search-results::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .insta-search-modal {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .insta-search-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .insta-search-content {
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .insta-search-modal.active .insta-search-content {
            transform: translateY(0);
        }
    </style>
</head>

<body class="bg-white">
    <div class="flex min-h-screen w-screen">
        <!-- Sidebar -->
        <div class="w-[20%] border-r border-instagram-border fixed h-full bg-white z-10">
            <div class="p-6">
                <h1 class="text-2xl font-semibold instagram-logo">Instagram</h1>
            </div>

            <nav class="mt-2">
                <a href="/dashboard" class="flex items-center px-6 py-3 hover:bg-gray-100 font-medium">
                    <i class="fa-solid fa-house text-xl w-6"></i>
                    <span class="ml-4">Home</span>
                </a>
                <p class="flex cursor-pointer items-center px-6 py-3 hover:bg-gray-100" id="insta-search-trigger">
                    <i class="fa-solid fa-search text-xl w-6"></i>
                    <span class="ml-4">Search</span>
                </p>
                <p id="openModalBtn" class="cursor-pointer flex items-center px-6 py-3 hover:bg-gray-100">
                    <i class="fa-regular fa-square-plus text-xl w-6"></i>
                    <span class="ml-4">Create</span>
                </p>
                <a href="/profile" class="flex items-center px-6 py-3 hover:bg-gray-100">
                    <!-- <img src="/placeholder.svg?height=24&width=24" class="w-6 h-6 rounded-full" alt="Profile"> -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-user-icon lucide-user">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                        <circle cx="12" cy="7" r="4" />
                    </svg>
                    <span class="ml-4">Profile</span>
                </a>

                <button id="sign-out" class="signout-btn flex items-center px-6 py-3 hover:bg-gray-100 w-full">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-log-out-icon lucide-log-out">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" x2="9" y1="12" y2="12" />
                    </svg>
                    <span class="ml-4"> Sign out</span>

                </button>
            </nav>
        </div>


        <!-- Post Form  -->
        <div id="modalBackdrop" class="fixed inset-0 modal-backdrop hidden z-10 flex items-center justify-center">
            <!-- Modal Content -->
            <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4 overflow-hidden">
                <!-- Modal Header -->
                <div class="border-b border-gray-200 p-4 flex justify-between items-center">
                    <button id="closeModalBtn" class="text-red-500  hover:text-red-700 font-semibold">
                        X
                    </button>
                    <h2 class="text-xl font-semibold text-center flex-grow">Create new post</h2>
                    <button id="submitBtn"
                        class="text-blue-500 font-medium hover:text-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
                        disabled>
                        Share
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="flex flex-col md:flex-row">
                    <!-- Left Side - Image Upload/Preview -->
                    <div
                        class="w-full md:w-1/2 border-r border-gray-200 flex flex-col items-center justify-center p-4 bg-gray-50 min-h-[400px]">
                        <div id="uploadContainer" class="flex flex-col items-center justify-center w-full h-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mb-4" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <p class="text-gray-500 mb-4 text-center">Drag photos and videos here</p>
                            <label for="imageUpload"
                                class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded cursor-pointer transition duration-300">
                                Select from computer
                            </label>
                            <input type="file" id="imageUpload" class="hidden" accept="image/jpeg, image/png">
                        </div>
                        <img id="imagePreview" class="hidden image-preview w-full h-full object-contain"
                            src="/placeholder.svg" alt="Preview">
                    </div>

                    <!-- Right Side - Description -->
                    <div class="w-full md:w-1/2 p-4 flex flex-col">
                        <!-- User Info -->
                        <div class="flex items-center mb-4">
                            <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                            </div>
                            <span class="ml-2 font-medium" id="newpostusername">username</span>
                        </div>

                        <!-- Description Textarea -->
                        <textarea id="description"
                            class="w-full h-64 resize-none border-0 focus:ring-0 focus:outline-none"
                            placeholder="Write a caption..."></textarea>

                        <div class="text-right text-gray-400 text-sm">
                            <span id="charCount">0</span>/2,200
                        </div>

                        <!-- Additional Options -->
                        <!-- <div class="mt-auto space-y-4">
                            <div class="flex justify-between items-center py-3 border-t border-gray-200">
                                <span>Add location</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </div>
                            <div class="flex justify-between items-center py-3 border-t border-gray-200">
                                <span>Add collaborators</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                </svg>
                            </div>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>


        <!-- Main Content -->
        <div id="content" class="w-[80%]">
            {% block content %}{% endblock %}
        </div>

    </div>

    <!-- Post Modal -->
    <div id="post-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white w-full max-w-4xl h-[90vh] flex rounded-lg overflow-hidden">
            <div class="w-3/5 bg-black flex items-center justify-center">
                <img id="modal-image" src="/placeholder.svg" class="max-h-full max-w-full" alt="Post">
            </div>
            <div class="w-2/5 flex flex-col">
                <div class="p-4 border-b border-gray-200 flex items-center">
                    <img id="modal-user-avatar" src="/placeholder.svg" class="w-8 h-8 rounded-full" alt="User">
                    <span id="modal-username" class="ml-3 font-semibold"></span>
                    <button class="ml-auto">
                        <i class="fa-solid fa-ellipsis"></i>
                    </button>
                </div>
                <div id="modal-comments" class="flex-1 overflow-y-auto p-4"></div>
                <div class="border-t border-gray-200 p-4">
                    <div class="flex items-center space-x-4 mb-3">
                        <button><i class="fa-regular fa-heart text-2xl"></i></button>
                        <button><i class="fa-regular fa-comment text-2xl"></i></button>
                        <button><i class="fa-regular fa-paper-plane text-2xl"></i></button>
                        <button class="ml-auto"><i class="fa-regular fa-bookmark text-2xl"></i></button>
                    </div>
                    <p id="modal-likes" class="font-semibold mb-1"></p>
                    <p id="modal-time" class="text-xs text-gray-500 mb-3"></p>
                    <div class="flex items-center border-t border-gray-200 pt-3">
                        <i class="fa-regular fa-face-smile text-2xl mr-3"></i>
                        <input type="text" placeholder="Add a comment..." class="flex-1 outline-none" maxlength="200">
                        <button class="text-instagram-blue font-semibold ml-3">Post</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="modalOverlay"
        class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <!-- Modal Content -->
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4 overflow-hidden">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-xl font-semibold text-gray-800">User Information</h2>
                <button id="closeUsernameModalBtn" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <form id="userForm" class="p-6 space-y-4">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                    <input type="text" id="name" name="name" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                    <input type="text" id="username" name="username" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <p class="text-sm text-red-500 hidden" id="errortext"></p>
                <button type="submit"
                    class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    Submit
                </button>
            </form>
        </div>
    </div>


    <!-- Search Modal (Initially Hidden) -->
    <div id="insta-search-modal"
        class="insta-search-modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="insta-search-content bg-white rounded-xl shadow-2xl w-full max-w-md mx-4">
            <!-- Modal Header with Close Button -->
            <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-xl font-semibold">Search Users</h2>
                <button id="insta-close-search" class="insta-close-btn text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Search Input -->
            <div class="relative p-4">
                <div class="absolute inset-y-0 left-0 flex items-center pl-7 pointer-events-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <input type="text" id="insta-search-input"
                    class="insta-search-field bg-gray-100 border border-gray-200 text-gray-900 text-sm rounded-full focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 pr-10 py-3"
                    placeholder="Search by profile name" autocomplete="off">
                <button id="insta-clear-button"
                    class="insta-clear-btn absolute inset-y-0 right-0 flex items-center pr-7 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Search Results -->
            <div id="insta-search-results" class="insta-search-results hidden px-4">
                <!-- Results will be populated here -->
            </div>

            <!-- Loading Indicator -->
            <div id="insta-loading-indicator" class="insta-loading hidden flex justify-center items-center py-4">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"></div>
            </div>

            <!-- No Results Message -->
            <div id="insta-no-results" class="insta-no-results hidden text-center py-4 text-gray-500">
                No results found
            </div>

            <!-- Footer -->
            <div class="p-4 border-t text-xs text-gray-500 text-center">
                Search matches the beginning of profile names
            </div>
        </div>
    </div>

    <script>

        var userEmail = ""
        var userDetails = ""
        var currentUser = ""
        const closeUsernameModalBtn = document.getElementById('closeUsernameModalBtn');
        const modalOverlay = document.getElementById('modalOverlay');
        const userForm = document.getElementById('userForm');

        // Function to close modal
        function closeModal() {
            modalOverlay.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        }
        closeUsernameModalBtn.addEventListener('click', closeModal);

        // Close modal when clicking outside the form
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                closeModal();
            }
        });
        // Handle form submission
        userForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value;
            const username = document.getElementById('username').value;

            // console.log('Form submitted:', { name, username });

            // You can add AJAX request here to submit the form data

            // Reset form and close modal
            // closeModal();

            // Show success message (optional)
            // alert(`Form submitted successfully!\nName: ${name}\nUsername: ${username}`);
            try {

                const updatedUsernameResponse = await fetch("/updateUserName", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ username: username, name: name, email: userEmail })
                })
                if (updatedUsernameResponse.status == 200) {
                    modalOverlay.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden');
                    userForm.reset();
                    updateUI();
                }
                else {
                    console.log("inside error ")
                    document.getElementById('errortext').classList.remove("hidden");
                    document.getElementById('errortext').innerText = "Error: username already exsit."
                }

            }
            catch (Error) {
                console.log("inside error ", Error)
                document.getElementById('errortext').classList.remove("hidden");
                document.getElementById('errortext').innerText = "Error: username already exsit."

            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !modalOverlay.classList.contains('hidden')) {
                closeModal();
            }
        });


        document.addEventListener('DOMContentLoaded', function () {
            // console.log("document loaded")

            function decodeJWT(token) {
                try {
                    const payload = token.split('.')[1];
                    return JSON.parse(atob(payload));
                } catch (error) {
                    return {};
                }
            }


            function getAuthTokenFromCookies(cookieString) {
                return cookieString
                    .split(';')
                    .map(entry => entry.trim().split('='))
                    .find(([key]) => key === 'token')?.[1] || "";
            }
            async function checkSession() {
                console.log("inside check session ")
                const token = getAuthTokenFromCookies(document.cookie);
                if (!token) {
                    location.href = "/"
                    return
                }

                userEmail = decodeJWT(token).email || "User";

                console.log("User detected:", userEmail);
                fetch("/checkandcreateuser", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ username: userEmail })
                })
                try {

                    const userDetailsResponse = await fetch("/getUser", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ username: userEmail })
                    })
                    if (userDetailsResponse.status == 200) {

                        const userDetailsJson = await userDetailsResponse.json();
                        userDetails = userDetailsJson.user;
                        checkUsername()
                    }
                }
                catch (Error) {
                    cosnole.log("Error is ", Error)
                }

            }


            async function checkUsername() {
                if (userDetails) {
                    console.log("user details ", userDetails)
                    if (userDetails.Username == "") {
                        modalOverlay.classList.remove('hidden');
                        document.body.classList.add('overflow-hidden');
                    }
                    else {

                        currentUser = {
                            username: userDetails.Username,
                            name: userDetails.name,
                            avatar: "/placeholder.svg?height=56&width=56",
                        }
                        document.getElementById("current-user-username").textContent = userDetails.Username
                        document.getElementById("newpostusername").textContent = userDetails.Username
                        document.getElementById("current-user-name").textContent = userDetails.name
                        document.getElementById("current-user-avatar").src = userDetails.avatar ? userDetails.avatar : 'https://img.freepik.com/free-vector/user-blue-gradient_78370-4692.jpg'

                    }
                }
            }

            checkSession()
        })



        // Mock API data
        const API_ENDPOINTS = {
            currentUser: "/api/user",
            posts: "/api/posts",
            stories: "/api/stories",
            suggestedUsers: "/api/suggested-users",
        }

        // // Current user data
        // currentUser = {
        //     username: "nithish_reddy27",
        //     name: "Nithish Reddy",
        //     avatar: "/placeholder.svg?height=56&width=56",
        // }

        // Mock posts data
        const postsData = [
            {
                post_id: "1",
                username: "rvcjinsta",
                verified: true,
                userAvatar: "/placeholder.svg?height=40&width=40",
                imageurl: "https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-PWQQChtiGBxY4FLCNqxRTmORxKTq8l.png",
                likes: 65410,
                description: "As Per ANI, Report...",
                comments: [
                    {
                        username: "i_am_harshvardhan.singh",
                        comment: "I don't know, But I feel ki we are heading towards a small scale war 😔",
                        time: "4h",
                        likes: 606,
                    },
                    {
                        username: "paridhigupta481",
                        comment: "We are heading towards war zone",
                        time: "4h",
                        likes: 262,
                    },
                    {
                        username: "hun_ainx1",
                        comment: "Bachooonnn",
                        time: "3h",
                        likes: 2,
                    },
                    {
                        username: "gerrard7890",
                        comment:
                            "He was having 17 years of experience and crossed accidentally? Ab saare plans hamare backfire karenge bcoz of this",
                        time: "4h",
                        likes: 180,
                    },
                    {
                        username: "mournful_soul_india",
                        comment: "zindabad kashmir hamesha india ka hai or tha or rahega",
                        time: "4h",
                        likes: 23,
                    },
                    {
                        username: "ranaaabajyeet",
                        comment: "Chud ne wala ha Pakistan",
                        time: "4h",
                        likes: 63,
                    },
                    {
                        username: "ahkam_and.memes",
                        comment: "Probably tea.",
                        time: "3h",
                        likes: 12,
                    },
                ],
                time: "3h",
            },
            {
                post_id: "2",
                username: "royalchallengersbengaluru",
                verified: true,
                userAvatar: "/placeholder.svg?height=40&width=40",
                imageurl: "/placeholder.svg?height=600&width=600",
                likes: 67004,
                description: "Match day! #PlayBold",
                comments: [
                    {
                        username: "cricket_lover",
                        comment: "Let's go RCB! 🔥",
                        time: "2h",
                        likes: 342,
                    },
                    {
                        username: "virat_fan",
                        comment: "King Kohli will score a century today!",
                        time: "1h",
                        likes: 256,
                    },
                ],
                time: "5m",
            },
            {
                post_id: "3",
                username: "instagram",
                verified: true,
                userAvatar: "/placeholder.svg?height=40&width=40",
                imageurl: "/placeholder.svg?height=600&width=600",
                likes: 1245789,
                description: "Introducing new features to help you connect with friends",
                comments: [
                    {
                        username: "tech_enthusiast",
                        comment: "These new features look amazing!",
                        time: "5h",
                        likes: 1245,
                    },
                    {
                        username: "social_media_expert",
                        comment: "Great update, but I still miss the chronological feed",
                        time: "4h",
                        likes: 3456,
                    },
                ],
                time: "1d",
            },
        ]

        // Mock stories data
        const storiesData = [
            { username: "karthi_vred...", avatar: "/placeholder.svg?height=56&width=56", hasStory: true },
            { username: "mr_confes...", avatar: "/placeholder.svg?height=56&width=56", hasStory: true },
            { username: "nisha_ra...", avatar: "/placeholder.svg?height=56&width=56", hasStory: true },
            { username: "sasupreet...", avatar: "/placeholder.svg?height=56&width=56", hasStory: true },
            { username: "varunsr...", avatar: "/placeholder.svg?height=56&width=56", hasStory: true },
            { username: "tanha_...", avatar: "/placeholder.svg?height=56&width=56", hasStory: true },
            { username: "sai_roshan...", avatar: "/placeholder.svg?height=56&width=56", hasStory: true },
            { username: "i_shiva...", avatar: "/placeholder.svg?height=56&width=56", hasStory: true },
        ]

        // Mock suggested users data
        const suggestedUsersData = [
            {
                username: "_nickandcarrie_",
                verified: true,
                avatar: "/placeholder.svg?height=32&width=32",
                followedBy: "venky_acharit + 7 more",
            },
            {
                username: "instagram",
                verified: true,
                avatar: "/placeholder.svg?height=32&width=32",
                followedBy: "maniac_ram + 19 more",
            },
            {
                username: "vedhika4u",
                verified: true,
                avatar: "/placeholder.svg?height=32&width=32",
                followedBy: "mandalamanoharnath",
            },
            { username: "siriluuu_1207", verified: false, avatar: "/placeholder.svg?height=32&width=32", suggestedFor: "you" },
            {
                username: "sahana_1401",
                verified: false,
                avatar: "/placeholder.svg?height=32&width=32",
                followedBy: "__vigreesh_23 + 13 more",
            },
        ]

        // Fetch data from API (mock implementation)
        async function fetchData(endpoint) {
            // In a real app, this would be a fetch call to the API
            switch (endpoint) {
                case API_ENDPOINTS.currentUser:
                    return currentUser
                case API_ENDPOINTS.posts:
                    return postsData
                case API_ENDPOINTS.stories:
                    return storiesData
                case API_ENDPOINTS.suggestedUsers:
                    return suggestedUsersData
                default:
                    throw new Error("Invalid endpoint")
            }
        }

        // Format number of likes
        function formatLikes(likes) {
            if (likes >= 1000000) {
                return (likes / 1000000).toFixed(1) + "M"
            } else if (likes >= 1000) {
                return (likes / 1000).toFixed(1) + "K"
            }
            return likes.toString()
        }



        // Add new comment to a post
        function addNewComment(postId, commentText) {
            // Find the post
            const post = postsData.find((p) => p.post_id === postId)

            if (post) {
                // Create new comment
                const newComment = {
                    username: currentUser.username,
                    comment: commentText,
                    time: "now",
                    likes: 0,
                }

                // Add to beginning of comments array (for reverse chronological order)
                post.comments.unshift(newComment)

                // Re-render posts to show the new comment
                document.getElementById("posts-container").innerHTML = ""
                renderPosts()
            }
        }

        // Open post modal
        function openPostModal(post) {
            const modal = document.getElementById("post-modal")
            const modalImage = document.getElementById("modal-image")
            const modalUserAvatar = document.getElementById("modal-user-avatar")
            const modalUsername = document.getElementById("modal-username")
            const modalComments = document.getElementById("modal-comments")
            const modalLikes = document.getElementById("modal-likes")
            const modalTime = document.getElementById("modal-time")

            // Set modal content
            modalImage.src = post.imageurl
            modalUserAvatar.src = post.userAvatar
            modalUsername.textContent = post.username
            modalLikes.textContent = formatLikes(post.likes) + " likes"
            modalTime.textContent = post.time

            // Clear previous comments
            modalComments.innerHTML = ""

            // Add post description as first comment
            const descriptionElement = document.createElement("div")
            descriptionElement.className = "flex mb-4"

            const descriptionAvatar = document.createElement("img")
            descriptionAvatar.src = post.userAvatar
            descriptionAvatar.className = "w-8 h-8 rounded-full mr-3"

            const descriptionContent = document.createElement("div")
            descriptionContent.innerHTML = `
    <span class="font-semibold">${post.username}</span>
    <span class="ml-2">${post.description}</span>
    <p class="text-xs text-gray-500 mt-1">${post.time}</p>
  `

            descriptionElement.appendChild(descriptionAvatar)
            descriptionElement.appendChild(descriptionContent)
            modalComments.appendChild(descriptionElement)

            // Add separator
            const separator = document.createElement("hr")
            separator.className = "my-4 border-gray-200"
            modalComments.appendChild(separator)

            // Sort comments in reverse chronological order
            const sortedComments = [...post.comments].sort((a, b) => {
                // Simple sorting based on time string (in a real app, use timestamps)
                if (a.time.includes("m") && b.time.includes("h")) return -1
                if (a.time.includes("h") && b.time.includes("m")) return 1

                // Extract numeric values for comparison
                const aValue = Number.parseInt(a.time)
                const bValue = Number.parseInt(b.time)
                return bValue - aValue
            })

            // Add all comments
            sortedComments.forEach((comment) => {
                const commentElement = document.createElement("div")
                commentElement.className = "flex mb-4"

                const commentAvatar = document.createElement("img")
                commentAvatar.src = "/placeholder.svg?height=32&width=32"
                commentAvatar.className = "w-8 h-8 rounded-full mr-3"

                const commentContent = document.createElement("div")
                commentContent.className = "flex-1"
                commentContent.innerHTML = `
      <div class="flex justify-between">
        <div>
          <span class="font-semibold">${comment.username}</span>
          <span class="ml-2">${comment.comment}</span>
        </div>
        <button class="text-gray-500">
          <i class="fa-regular fa-heart"></i>
        </button>
      </div>
      <div class="flex text-xs text-gray-500 mt-1">
        <span>${comment.time}</span>
        <span class="mx-2">·</span>
        <span>${comment.likes} likes</span>
        <button class="ml-2">Reply</button>
      </div>
    `

                commentElement.appendChild(commentAvatar)
                commentElement.appendChild(commentContent)
                modalComments.appendChild(commentElement)
            })

            // Show modal
            modal.classList.remove("hidden")

            // Close modal when clicking outside
            modal.addEventListener("click", (e) => {
                if (e.target === modal) {
                    modal.classList.add("hidden")
                }
            })
        }

        // Initialize app
        async function initApp() {
            // Set current user info
            const user = await fetchData(API_ENDPOINTS.currentUser)


            // // Render components
            // await renderStories()
            // await renderPosts()
            // await renderSuggestedUsers()
        }

        // Start the app
        document.addEventListener("DOMContentLoaded", initApp)

    </script>

    <script>
        // DOM Elements
        var file = null
        const openModalBtn = document.getElementById('openModalBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const modalBackdrop = document.getElementById('modalBackdrop');
        const imageUpload = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('imagePreview');
        const uploadContainer = document.getElementById('uploadContainer');
        const description = document.getElementById('description');
        const charCount = document.getElementById('charCount');
        const submitBtn = document.getElementById('submitBtn');

        // Event Listeners
        openModalBtn.addEventListener('click', openModal);
        closeModalBtn.addEventListener('click', closeModal);
        modalBackdrop.addEventListener('click', (e) => {
            if (e.target === modalBackdrop) closeModal();
        });
        imageUpload.addEventListener('change', handleImageUpload);
        description.addEventListener('input', updateCharCount);

        // Functions
        function openModal() {
            modalBackdrop.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }

        function closeModal() {
            modalBackdrop.classList.add('hidden');
            document.body.style.overflow = ''; // Re-enable scrolling

            // Reset form
            imagePreview.classList.add('hidden');
            uploadContainer.classList.remove('hidden');
            imageUpload.value = '';
            description.value = '';
            updateCharCount();
        }

        function handleImageUpload(e) {
            file = e.target.files[0];
            if (!file) return;

            // Check if file is jpg or png
            if (!['image/jpeg', 'image/png'].includes(file.type)) {
                alert('Please select a JPG or PNG image.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (event) {
                imagePreview.src = event.target.result;
                imagePreview.classList.remove('hidden');
                uploadContainer.classList.add('hidden');
                submitBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        function updateCharCount() {
            const count = description.value.length;
            charCount.textContent = count;

            // Enable submit button only if there's an image and text
            if (!imagePreview.classList.contains('hidden')) {
                submitBtn.disabled = false;
            }
        }

        // Form submission
        submitBtn.addEventListener('click', function () {
            // Here you would typically send the data to a server
            // For this example, we'll just show an alert
            // alert('Post created successfully!');
            const formData = new FormData();
            formData.append('file_name', file);
            formData.append('description', description.value);
            fetch('/upload-file', {
                method: 'POST',
                body: formData,
            })
                .then(response => {
                    if (response.ok) {
                        alert('File uploaded successfully!');
                        closeModal(); // Your existing function
                    } else {
                        alert('Failed to upload file.');
                    }
                })
                .catch(error => {
                    console.error('Error uploading:', error);
                    alert('Error uploading file.');
                });
            // console.log("description ", description.value)
        });

        // Drag and drop functionality
        const dropArea = document.getElementById('uploadContainer');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dropArea.classList.add('bg-blue-50', 'border-blue-300');
        }

        function unhighlight() {
            dropArea.classList.remove('bg-blue-50', 'border-blue-300');
        }

        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const file = dt.files[0];

            if (!file) return;

            // Check if file is jpg or png
            if (!['image/jpeg', 'image/png'].includes(file.type)) {
                alert('Please select a JPG or PNG image.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (event) {
                imagePreview.src = event.target.result;
                imagePreview.classList.remove('hidden');
                uploadContainer.classList.add('hidden');
                submitBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }
    </script>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Modal elements
            const searchModal = document.getElementById('insta-search-modal');
            const searchTrigger = document.getElementById('insta-search-trigger');
            const closeSearch = document.getElementById('insta-close-search');

            // Search elements
            const searchInput = document.getElementById('insta-search-input');
            const searchResults = document.getElementById('insta-search-results');
            const loadingIndicator = document.getElementById('insta-loading-indicator');
            const noResults = document.getElementById('insta-no-results');
            const clearButton = document.getElementById('insta-clear-button');

            let users = [];
            let debounceTimer;

            // Fetch users when the page loads
            fetchUsers();

            // Function to fetch users
            async function fetchUsers() {
                try {
                    loadingIndicator.classList.remove('hidden');

                    // Replace this URL with your actual API endpoint
                    const response = await fetch('/getallusers');
                    const data = await response.json();
                    console.log("Data is ", data)
                    // For demonstration, we'll use mock data if the fetch fails
                    users = data.users || getMockUsers();

                    loadingIndicator.classList.add('hidden');
                } catch (error) {
                    console.error('Error fetching users:', error);
                    loadingIndicator.classList.add('hidden');

                    // Use mock data for demonstration
                    users = getMockUsers();
                }
            }

            // Function to get mock users for demonstration
            function getMockUsers() {
                return [
                    { username: 'john_doe', profileName: 'John Doe', profilePic: 'https://i.pravatar.cc/150?img=1' },
                    { username: 'jane_smith', profileName: 'Jane Smith', profilePic: 'https://i.pravatar.cc/150?img=5' },
                    { username: 'alex_wilson', profileName: 'Alex Wilson', profilePic: 'https://i.pravatar.cc/150?img=3' },
                    { username: 'sarah_johnson', profileName: 'Sarah Johnson', profilePic: 'https://i.pravatar.cc/150?img=4' },
                    { username: 'mike_brown', profileName: 'Mike Brown', profilePic: 'https://i.pravatar.cc/150?img=6' },
                    { username: 'jessica_taylor', profileName: 'Jessica Taylor', profilePic: 'https://i.pravatar.cc/150?img=7' },
                    { username: 'david_miller', profileName: 'David Miller', profilePic: 'https://i.pravatar.cc/150?img=8' },
                    { username: 'emily_davis', profileName: 'Emily Davis', profilePic: 'https://i.pravatar.cc/150?img=9' },
                    { username: 'james_wilson', profileName: 'James Wilson', profilePic: 'https://i.pravatar.cc/150?img=10' },
                    { username: 'olivia_martin', profileName: 'Olivia Martin', profilePic: 'https://i.pravatar.cc/150?img=11' },
                    { username: 'daniel_anderson', profileName: 'Daniel Anderson', profilePic: 'https://i.pravatar.cc/150?img=12' },
                    { username: 'sophia_thomas', profileName: 'Sophia Thomas', profilePic: 'https://i.pravatar.cc/150?img=13' },
                    { username: 'matthew_jackson', profileName: 'Matthew Jackson', profilePic: 'https://i.pravatar.cc/150?img=14' },
                    { username: 'ava_white', profileName: 'Ava White', profilePic: 'https://i.pravatar.cc/150?img=15' },
                    { username: 'joseph_harris', profileName: 'Joseph Harris', profilePic: 'https://i.pravatar.cc/150?img=16' }
                ];
            }

            // Open search modal
            searchTrigger.addEventListener('click', function () {
                searchModal.classList.add('active');
                setTimeout(() => {
                    searchInput.focus();
                }, 300);
            });

            // Close search modal
            closeSearch.addEventListener('click', function () {
                searchModal.classList.remove('active');
                resetSearch();
            });

            // Close modal when clicking outside
            searchModal.addEventListener('click', function (e) {
                if (e.target === searchModal) {
                    searchModal.classList.remove('active');
                    resetSearch();
                }
            });

            // Reset search state
            function resetSearch() {
                searchInput.value = '';
                searchResults.classList.add('hidden');
                noResults.classList.add('hidden');
                clearButton.classList.add('hidden');
            }

            // Search input event listener
            searchInput.addEventListener('input', function () {
                const searchTerm = this.value.trim();

                // Show/hide clear button
                if (searchTerm.length > 0) {
                    clearButton.classList.remove('hidden');
                } else {
                    clearButton.classList.add('hidden');
                }

                // Debounce search to avoid too many searches while typing
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    if (searchTerm.length > 0) {
                        searchUsers(searchTerm);
                    } else {
                        searchResults.classList.add('hidden');
                        noResults.classList.add('hidden');
                    }
                }, 300);
            });

            // Clear button event listener
            clearButton.addEventListener('click', function () {
                searchInput.value = '';
                searchResults.classList.add('hidden');
                noResults.classList.add('hidden');
                clearButton.classList.add('hidden');
                searchInput.focus();
            });

            // Function to search users
            function searchUsers(searchTerm) {
                // Filter users by profile name (matching the beginning)
                console.log("searchh term ", searchTerm)
                const filteredUsers = users.filter(user =>
                    user.profileName?.toLowerCase().startsWith(searchTerm.toLowerCase())
                );

                // Display results
                if (filteredUsers.length > 0) {
                    displayResults(filteredUsers);
                    searchResults.classList.remove('hidden');
                    noResults.classList.add('hidden');
                } else {
                    searchResults.classList.add('hidden');
                    noResults.classList.remove('hidden');
                }
            }

            // Function to display search results
            function displayResults(results) {
                searchResults.innerHTML = '';

                results.forEach(user => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'insta-result-item flex items-center p-3 hover:bg-gray-100 cursor-pointer rounded-md';
                    resultItem.innerHTML = `
                    <a href="/userprofile/${user.username}" class="flex">
                        <div class="insta-user-avatar flex-shrink-0">
                            <img 
                                class="h-12 w-12 rounded-full object-cover" 
                                src="${user.profilePic}" 
                                alt="User profile picture"
                                onerror="this.onerror=null; this.src='https://img.freepik.com/free-vector/blue-circle-with-white-user_78370-4707.jpg';"
                                />

                        </div>
                        <div class="insta-user-info ml-3">
                            <p class="insta-profile-name text-sm font-medium text-gray-900">${user.profileName}</p>
                            <p class="insta-username text-sm text-gray-500">@${user.username}</p>
                        </div>
                    </a>
                `;

                    // Add click event to result item
                    resultItem.addEventListener('click', function () {
                        // Handle click on user (e.g., navigate to profile)
                        console.log(`Clicked on user: ${user.username}`);
                        // You can add navigation or other actions here

                        // Close the modal after selection
                        searchModal.classList.remove('active');
                        resetSearch();
                    });

                    searchResults.appendChild(resultItem);
                });
            }

            // Close modal with Escape key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && searchModal.classList.contains('active')) {
                    searchModal.classList.remove('active');
                    resetSearch();
                }
            });
        });
    </script>

    <!-- <script type="module" src="../static/firebase-login.js"></script> -->
    <script type="module" src="{{ url_for('static', path='/firebase-login.js') }}"></script>

</body>

</html>